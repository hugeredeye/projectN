# Система анализа и сравнения документов

Данная система предназначена для автоматического анализа и сравнения технических документов с техническим заданием (ТЗ). Система использует модель DeepSeek R1 Distill через Groq API для быстрого и точного анализа содержимого документов и выявления соответствия требованиям ТЗ.

## Основные возможности

- Загрузка и анализ технических документов (PDF, DOCX, TXT)
- Автоматическое сравнение содержимого документов с требованиями ТЗ
- Классификация выявленных расхождений по степени критичности
- Генерация отчетов о соответствии документов требованиям
- Объяснение конкретных пунктов ТЗ в понятной форме
- Мгновенный анализ благодаря использованию Groq API

## Установка и настройка

### Вариант 1: Запуск через Docker (рекомендуется)

1. Установите Docker и Docker Compose на вашу систему
2. Склонируйте репозиторий:
```bash
git clone <url-репозитория>
cd PROJECTN
```

3. Создайте файл `.env` в корневой директории проекта и добавьте в него ваш Groq API ключ:
```
GROQ_API_KEY=ваш_ключ_здесь
```

4. Запустите приложение через Docker Compose:
```bash
docker-compose up --build
```

Приложение будет доступно по адресу http://localhost:8000

### Вариант 2: Локальная установка

#### Системные требования

- Python 3.8+
- 4 ГБ ОЗУ или больше
- Подключение к интернету (для работы с Groq API)

#### Установка зависимостей

```bash
pip install -r requirements.txt
```

#### Настройка доступа к Groq API

Для работы с моделью DeepSeek через Groq требуется API ключ. Для настройки выполните следующие шаги:

1. Создайте аккаунт на [Groq Console](https://console.groq.com)
2. Получите API ключ на странице [API Keys](https://console.groq.com/keys)
3. Запустите скрипт настройки токена:

```bash
python set_token.py
```

4. Введите ваш Groq API ключ (начинается с "gsk_")

#### Настройка базы данных

По умолчанию система использует SQLite БД. Для использования PostgreSQL необходимо изменить настройки подключения в файле `config.py`.

## Запуск приложения

### При использовании Docker:
```bash
# Запуск в фоновом режиме
docker-compose up -d

# Просмотр логов
docker-compose logs -f

# Остановка приложения
docker-compose down
```

### При локальной установке:
```bash
# Запуск через скрипт настройки токена
python set_token.py

# Или прямой запуск (если токен уже настроен)
python main.py
```

После запуска приложение будет доступно по адресу http://127.0.0.1:8000

## Запуск с VPN в Docker

Проект настроен для автоматического подключения к VPN при запуске Docker-контейнера.

### Подготовка

1. Убедитесь, что у вас есть файл конфигурации OpenVPN (`.ovpn`)
2. Файл должен находиться в корневой директории проекта
3. В `.env` файле должен быть указан ваш GROQ_API_KEY

### Запуск

```bash
# Сборка и запуск контейнеров
docker-compose up --build -d

# Проверка логов контейнера приложения
docker-compose logs -f app
```

### Проверка VPN-соединения

Чтобы проверить, что VPN-соединение успешно установлено, выполните:

```bash
# Подключение к контейнеру
docker-compose exec app bash

# Проверка сетевых интерфейсов (должен быть виден tun0)
ip addr | grep tun

# Проверка маршрутизации
ip route

# Проверка IP-адреса
curl -s https://ipinfo.io
```

### Проверка IP-адреса

Чтобы убедиться, что запросы идут через VPN, вы можете проверить свой IP-адрес:

#### Проверка IP-адреса внутри контейнера:
```bash
# Подключение к контейнеру
docker-compose exec app bash

# Проверка IP-адреса через ipinfo.io
curl -s https://ipinfo.io

# Проверка IP-адреса через другие сервисы
curl -s https://api.myip.com
curl -s https://ifconfig.me
```

#### Сравнение IP-адресов:

Для проверки работы VPN сравните IP-адреса:

```bash
# Проверка IP-адреса хост-машины (без VPN)
curl -s https://ipinfo.io

# Проверка IP-адреса в контейнере (через VPN)
docker-compose exec app curl -s https://ipinfo.io
```

Если IP-адреса отличаются, значит VPN работает корректно, и контейнер использует VPN-подключение.

### Проверка API на хосте

После запуска контейнера с VPN, вы можете проверить работу API с хост-машины:

```bash
# Проверка доступности основного интерфейса
curl http://localhost:8000

# Проверка API документации
curl http://localhost:8000/docs

# Отправка тестового запроса API (с Windows PowerShell)
$headers = @{
    "Content-Type" = "application/json"
}
$body = '{"query": "Тестовый запрос"}'
Invoke-RestMethod -Uri "http://localhost:8000/api/v1/analyze" -Method Post -Headers $headers -Body $body

# Отправка тестового запроса API (с Linux/Mac)
curl -X POST "http://localhost:8000/api/v1/analyze" \
     -H "Content-Type: application/json" \
     -d '{"query": "Тестовый запрос"}'
```

Все API-запросы, требующие доступ к внешним сервисам (например, Groq API), будут выполняться через VPN-соединение, установленное в контейнере.

### Дополнительная информация

- VPN подключается автоматически при запуске контейнера
- Настройки VPN находятся в файле конфигурации `.ovpn`
- Маршруты Docker сохраняются для доступа к базе данных и другим сервисам
- В случае проблем с подключением проверьте логи OpenVPN: `docker-compose exec app cat /var/log/openvpn.log`

### Как это работает

1. При запуске контейнера скрипт `start.sh` сохраняет текущие маршруты Docker
2. Затем запускается OpenVPN в фоновом режиме
3. После подключения к VPN восстанавливаются маршруты для сети Docker
4. Настраивается правильное разрешение имен DNS
5. Запускается основное приложение

## Использование

1. Откройте веб-интерфейс по адресу http://127.0.0.1:8000
2. Загрузите файл ТЗ (эталонный документ)
3. Загрузите документы для сравнения
4. Запустите процесс сравнения
5. Просмотрите результаты анализа в веб-интерфейсе

## Преимущества использования Groq API

- Мгновенный анализ документов благодаря оптимизированной инфраструктуре Groq
- Высокая точность анализа с использованием модели DeepSeek R1 Distill
- Отсутствие необходимости в локальной установке тяжелых моделей
- Масштабируемость и надежность облачной инфраструктуры

## Дополнительно

- Система автоматически очищает неиспользуемые файлы
- Все операции логируются для отслеживания работы системы
- Поддерживается параллельная обработка нескольких запросов

## Лицензия

Проект распространяется под лицензией MIT. 

## Безопасность

- Все запросы к Groq API выполняются через защищенное соединение
- Данные документов хранятся только локально и не передаются третьим лицам
- API ключи хранятся в защищенном виде в переменных окружения

# Проект Документ-анализатор

## Запуск проекта с автоматическим определением ОС

Проект настроен для оптимальной работы на различных операционных системах: macOS, Windows и Linux.

### Автоматический запуск (рекомендуется)

Для автоматического определения ОС и запуска с оптимальными настройками, используйте:

```bash
./select-docker-config.sh up
```

Этот скрипт автоматически:
1. Определит вашу операционную систему
2. Выберет оптимальную конфигурацию Docker для вашей ОС
3. Запустит проект с нужными параметрами

### Ручной выбор конфигурации

Вы также можете вручную выбрать конфигурацию:

```bash
# Для macOS
docker-compose -f docker-compose.mac.yml up

# Для Windows
docker-compose -f docker-compose.windows.yml up

# Для Linux
docker-compose -f docker-compose.linux.yml up
```

## Оптимизации для разных ОС

### macOS
- Использование флага `:delegated` для томов
- Увеличенное время ожидания для VPN-соединения
- Специальные настройки сети для Docker Desktop на macOS
- Оптимизация параметров TCP

### Windows
- Конфигурация для работы в WSL2
- Базовые настройки VPN и сети
- Оптимизированная работа с DNS

### Linux
- Стандартная конфигурация Docker
- Быстрая настройка сети и VPN

## Параметры запуска

Все параметры docker-compose поддерживаются скриптом:

```bash
# Запуск в фоновом режиме
./select-docker-config.sh up -d

# Остановка контейнеров
./select-docker-config.sh down

# Пересборка образов
./select-docker-config.sh build
```

## Доступ к приложению

После запуска:
- Веб-интерфейс приложения: http://localhost:8000
- PgAdmin: http://localhost:5052 (admin@admin.com / admin)
- База данных доступна на порту 5434
